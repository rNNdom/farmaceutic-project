//get dotenv to use .env file
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

generator client {
    provider = "prisma-client-js"
}

model User {
    usr_id         Int        @id @default(autoincrement())
    usr_email      String     @unique
    usr_pass       String
    usr_role       Role       @default(USER)
    usr_profile    Int
    usr_status     UserStatus @default(NORMAL)
    profile        Profile    @relation(fields: [usr_profile], references: [prf_id], onUpdate: Cascade, onDelete: Cascade)
    usr_vip        Boolean
    Order_Customer Order[]    @relation(name: "Order_Customer")
    Order_Delivery Order[]    @relation(name: "Order_Delivery")

    @@index([usr_role])
    @@index([usr_profile])
}

enum Role {
    ADMIN
    USER
    DELIVER
}

enum UserStatus {
    DELIVERING
    AVAILABLE
    UNAVAILABLE
    NORMAL
}

enum OrderStatus {
    PENDING
    DELIVERING
    DELIVERED
    CANCELED
}

model ProductOrderDetail {
    pod_id        Int         @id @default(autoincrement())
    quantity      Int
    productId     Int
    orderDetailId Int
    Product       Product     @relation(fields: [productId], references: [prod_id])
    OrderDetail   OrderDetail @relation(fields: [orderDetailId], references: [order_det_id], onUpdate: Cascade, onDelete: Cascade)

    @@index([productId])
    @@index([orderDetailId])
}

model Product {
    prod_id            Int                  @id @default(autoincrement())
    prod_name          String               @db.Text
    prod_date_expir    DateTime
    prod_date_pack     DateTime
    prod_status        String               @db.Text
    prod_image         String               @db.Text
    prod_brand         String               @db.Text
    prod_price         Int
    prod_description   String               @db.Text
    prod_quantity      Int
    prod_tablet        String               @db.Text
    prod_detail        String               @db.Text
    prod_category      String               @db.Text
    prod_recipe        Boolean              @default(false)
    ProductOrderDetail ProductOrderDetail[]
}

model Order {
    order_id          Int           @id @default(autoincrement())
    order_date_of_ord DateTime      @default(now())
    order_status      OrderStatus   @default(PENDING)
    order_customer    Int
    // order_details     Int
    order_delivery    Int
    order_location    String
    user              User          @relation(name: "Order_Customer", fields: [order_customer], references: [usr_id])
    OrderDetail       OrderDetail[]
    // OrderDetail       OrderDetail @relation(fields: [order_details], references: [order_det_id], onUpdate: Cascade, onDelete: Cascade)
    delivery_user     User?         @relation(name: "Order_Delivery", fields: [order_delivery], references: [usr_id])

    @@index([order_customer])
    @@index([order_delivery])
}

model OrderDetail {
    order_det_id       Int                  @id @default(autoincrement())
    order_det_total    Int
    order_det_recipe   Boolean?
    ProductOrderDetail ProductOrderDetail[]
    Order              Order                @relation(fields: [order_det_id], references: [order_id], onUpdate: Cascade, onDelete: Cascade)

    @@index([order_det_id])
}

model Profile {
    prf_id       Int    @id @default(autoincrement())
    prf_name     String
    prf_lastname String
    prf_phone    String
    Users        User[]
}

