//get dotenv to use .env file
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

generator client {
    provider = "prisma-client-js"
}

model User {
    usr_id         Int     @id @default(autoincrement())
    usr_email      String  @unique
    usr_pass       String
    usr_role       Role    @default(USER)
    usr_profile    Int
    profile        Profile @relation(fields: [usr_profile], references: [prf_id])
    usr_vip        Boolean
    Order_Customer Order[] @relation(name: "Order_Customer")
    Order_Delivery Order[] @relation(name: "Order_Delivery")

    @@index([usr_role])
    @@index([usr_profile])
}

enum Role {
    ADMIN
    USER
    DELIVER
}

enum OrderStatus {
    PENDING
    DELIVERING
    DELIVERED
    CANCELED
}

model Product {
    prod_id          Int           @id @default(autoincrement())
    prod_name        String
    prod_date_expir  DateTime
    prod_date_pack   DateTime
    prod_status      String
    prod_image       String
    // prod_reviews     Int
    prod_brand       String
    prod_price       Int
    prod_description String
    prod_quantity    Int
    prod_tablet      String
    prod_detail      String
    prod_category    String
    OrderDetail      OrderDetail[]
}

model Order {
    order_id          Int         @id @default(autoincrement())
    order_date_of_ord DateTime    @default(now())
    order_status      OrderStatus @default(PENDING)
    order_customer    Int
    order_details     Int
    order_delivery    Int
    order_location    String
    User              User        @relation(name: "Order_Customer", fields: [order_customer], references: [usr_id])
    OrderDetail       OrderDetail @relation(fields: [order_details], references: [order_det_id])
    DeliveryUser      User?       @relation(name: "Order_Delivery", fields: [order_delivery], references: [usr_id])

    @@index([order_details])
    @@index([order_customer])
    @@index([order_delivery])
}

model OrderDetail {
    order_det_id       Int      @id @default(autoincrement())
    order_det_prod     Int
    order_det_quantity Int
    order_det_total    Int
    order_det_recipe   Boolean?
    product            Product  @relation(fields: [order_det_prod], references: [prod_id])
    Order              Order[]

    @@index([order_det_prod])
}

model Profile {
    prf_id       Int    @id @default(autoincrement())
    prf_name     String
    prf_lastname String
    prf_phone    String
    Users        User[]
}
